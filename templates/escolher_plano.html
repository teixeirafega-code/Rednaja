<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escolher Plano - FacilityMei</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { 
            background: #05080f; 
            color: #e2e8f0; 
            font-family: 'Inter', system-ui, sans-serif;
        }
        .card { background: #0f172a; border: 1px solid #1e2937; }
        .pro-card {
            background: linear-gradient(145deg, #0f172a, #1e2937);
            border: 2px solid #10b981;
            box-shadow: 0 0 0 12px rgba(16, 185, 129, 0.12);
        }
        .number {
            font-size: 3.25rem;
            font-weight: 700;
            letter-spacing: -0.06em;
            line-height: 1;
        }
        .btn-pro {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 10px 15px -3px rgb(16 185 129 / 0.4);
        }
        .btn-pro:hover { transform: translateY(-2px); }
        .support-fab {
            position: fixed;
            left: 1rem;
            bottom: 1rem;
            z-index: 80;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navbar igual ao dashboard -->
    <nav class="bg-[#0a1321] border-b border-slate-800 sticky top-0 z-50 backdrop-blur-lg">
        <div class="max-w-7xl mx-auto px-8 py-5 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-emerald-500 rounded-2xl flex items-center justify-center">
                    <img src="{{ url_for('static', filename='images/LOGO-SITE.jpeg') }}" alt="Logo Facilitymei" class="w-full h-full object-cover rounded-2xl">
                </div>
                <span class="text-2xl font-semibold tracking-tighter">Facilitymei</span>
            </div>
            <a href="{{ url_for('dashboard') }}" class="flex items-center gap-2 text-slate-400 hover:text-white transition">
                ← Voltar ao Dashboard
            </a>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-8 py-16">

        <!-- Cabeçalho -->
        <div class="max-w-3xl mx-auto text-center mb-16">
            <div class="inline-flex items-center gap-3 bg-amber-500/10 text-amber-400 px-6 py-3 rounded-3xl mb-8">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span class="font-semibold tracking-wide">Conciliação pendente</span>
            </div>
            <h1 class="text-5xl font-semibold tracking-tighter leading-none mb-6">
                Desbloqueie o Plano Pro<br>e veja seu lucro real
            </h1>
            <p class="text-xl text-slate-400 max-w-lg mx-auto">
                Você já fez a conciliação. Agora libere o relatório completo, PDF e alertas inteligentes.
            </p>
        </div>

        <!-- Resumo da conciliação pendente (conexão real com o dashboard) -->
        {% if conciliacao %}
        <div class="max-w-2xl mx-auto mb-16">
            <div class="card rounded-3xl p-9 border border-amber-400/30">
                <h3 class="uppercase text-xs tracking-[1px] text-amber-400 font-medium mb-6">Sua conciliação de hoje</h3>
                <div class="grid grid-cols-3 gap-8 text-center">
                    <div>
                        <p class="text-slate-400 text-sm">Extrato</p>
                        <p class="text-2xl font-semibold mt-2">{{ conciliacao.total_extrato | default(0) | format_br }}</p>
                    </div>
                    <div>
                        <p class="text-slate-400 text-sm">Vendas</p>
                        <p class="text-2xl font-semibold mt-2">{{ conciliacao.total_vendas | default(0) | format_br }}</p>
                    </div>
                    <div>
                        <p class="text-slate-400 text-sm">Divergência</p>
                        <p class="text-3xl font-bold {% if conciliacao.divergencia >= 0 %}text-emerald-400{% else %}text-red-400{% endif %} mt-2">
                            {{ conciliacao.divergencia | default(0) | format_br }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Planos -->
        <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">

            <!-- Básico -->
            <div class="card rounded-3xl p-10 flex flex-col">
                <h2 class="text-3xl font-semibold mb-1">Básico</h2>
                <div class="flex items-baseline mb-10">
                    <span class="number text-white">39</span>
                    <span class="text-slate-400 text-2xl ml-2">/mês</span>
                </div>
                <ul class="space-y-6 flex-1 mb-10 text-slate-300">
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Relatórios PDF</li>
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Histórico salvo</li>
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Até 100 lançamentos</li>
                </ul>
                <a href="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=01f4522ce4124c42a0783ba3b76885df" 
                   class="block w-full py-6 text-center bg-slate-700 hover:bg-slate-600 font-semibold text-lg rounded-3xl transition">
                    Assinar Básico
                </a>
            </div>

            <!-- Pro (destaque) -->
            <div class="pro-card rounded-3xl p-10 flex flex-col relative">
                <div class="absolute -top-5 left-1/2 -translate-x-1/2 bg-emerald-500 text-white text-xs font-bold px-8 py-3 rounded-3xl shadow-2xl">
                    ⭐ MAIS ESCOLHIDO
                </div>
                <h2 class="text-3xl font-semibold mb-1 mt-8">Pro</h2>
                <div class="flex items-baseline mb-6">
                    <span class="number text-emerald-400">59</span>
                    <span class="text-slate-400 text-2xl ml-2">/mês</span>
                </div>
                <div class="text-emerald-400 text-sm font-medium mb-10">Menos de R$ 2 por dia</div>
                <ul class="space-y-6 flex-1 mb-10 text-slate-300">
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Tudo ilimitado</li>
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> PDF + WhatsApp + Exportação</li>
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Alertas automáticos</li>
                    <li class="flex gap-4"><i class="bi bi-check-circle text-emerald-400 text-2xl"></i> Suporte prioritário</li>
                </ul>
                <a href="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=c7d42c4c67ce442b9b5a46ebeac1ee8d" 
                   class="btn-pro block w-full py-7 text-center text-white font-semibold text-xl rounded-3xl transition">
                    Assinar Plano Pro AGORA
                </a>
            </div>
        </div>

        <!-- Garantias -->
        <div class="max-w-md mx-auto mt-20 text-center space-y-6 text-sm text-slate-400">
            <div class="flex justify-center items-center gap-4"><i class="bi bi-arrow-repeat text-2xl text-emerald-400"></i> Cancele quando quiser</div>
            <div class="flex justify-center items-center gap-4"><i class="bi bi-shield-lock text-2xl text-emerald-400"></i> Seus dados 100% seguros</div>
            <div class="flex justify-center items-center gap-4"><i class="bi bi-lightning-charge text-2xl text-emerald-400"></i> Acesso imediato após o pagamento</div>
        </div>

        <div class="text-center mt-16">
            <a href="{{ url_for('dashboard') }}" class="text-slate-400 hover:text-white transition text-sm">
                ← Voltar e continuar na versão gratuita por enquanto
            </a>
        </div>

    </main>

    <button id="openSupportModal" type="button" class="support-fab bg-emerald-900/85 hover:bg-emerald-800 text-emerald-100 text-xs font-medium px-4 py-3 rounded-full border border-emerald-500/40 shadow-lg shadow-emerald-900/30 transition">
        <i class="bi bi-headset mr-1"></i> Falar com suporte
    </button>

    <div id="supportModal" class="hidden fixed inset-0 z-[95]">
        <div id="supportBackdrop" class="absolute inset-0 bg-black/65"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-md rounded-3xl border border-slate-700 bg-[#0b1220] p-6 shadow-2xl">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Qual foi o problema?</h3>
                    <button id="closeSupportModal" type="button" class="text-slate-400 hover:text-white">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <form id="supportForm" class="space-y-4">
                    <select id="supportReason" class="w-full rounded-2xl border border-slate-600 bg-slate-900 px-4 py-3 text-white" required>
                        <option value="">Selecione o motivo</option>
                        <option>Erro ao subir extrato</option>
                        <option>Erro no calculo</option>
                        <option>Duvida sobre score</option>
                        <option>Erro nos planos</option>
                        <option>Outro</option>
                    </select>
                    <textarea id="supportExtra" rows="3" class="w-full rounded-2xl border border-slate-600 bg-slate-900 px-4 py-3 text-white" placeholder="Detalhe rapido (opcional)"></textarea>
                    <button type="submit" class="w-full rounded-2xl bg-emerald-500 hover:bg-emerald-400 text-black font-semibold py-3 transition">
                        Abrir WhatsApp
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const supportModal = document.getElementById('supportModal');
        const openSupportModal = document.getElementById('openSupportModal');
        const closeSupportModal = document.getElementById('closeSupportModal');
        const supportBackdrop = document.getElementById('supportBackdrop');
        const supportForm = document.getElementById('supportForm');
        const supportReason = document.getElementById('supportReason');
        const supportExtra = document.getElementById('supportExtra');
        const SUPPORT_PHONE = '5515991464183';

        const openSupportBox = () => supportModal && supportModal.classList.remove('hidden');
        const closeSupportBox = () => supportModal && supportModal.classList.add('hidden');

        if (openSupportModal) openSupportModal.addEventListener('click', openSupportBox);
        if (closeSupportModal) closeSupportModal.addEventListener('click', closeSupportBox);
        if (supportBackdrop) supportBackdrop.addEventListener('click', closeSupportBox);

        if (supportForm) {
            supportForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const motivo = (supportReason && supportReason.value || '').trim();
                if (!motivo) return;
                const extra = (supportExtra && supportExtra.value || '').trim();
                const msg =
                    `Ola, preciso de suporte no Facilitymei.%0A` +
                    `Problema: ${encodeURIComponent(motivo)}%0A` +
                    (extra ? `Detalhes: ${encodeURIComponent(extra)}%0A` : '') +
                    `Pagina: Escolher Plano`;
                window.open(`https://wa.me/${SUPPORT_PHONE}?text=${msg}`, '_blank', 'noopener');
                closeSupportBox();
            });
        }
    </script>

</body>
</html>
